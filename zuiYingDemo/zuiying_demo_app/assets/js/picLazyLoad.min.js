;(function ($) {

    _picCenter = function(picBox){
        var picBoxWidth = picBox.width();
        var picBoxHeight = picBox.height();
        var picBoxScale = picBoxWidth/picBoxHeight;
        var picWidth = picBox.find('img').width();
        var picHeight =picBox.find('img').height();
        var picScale = picWidth/picHeight;
        if(picBoxScale>=picScale){
            picBox.find('img').css('height','100%')
        } else if(picBoxScale<picScale){
            picHeightScale = 1/picScale*picBoxWidth;
            picBox.find('img').css('width','100%').css('top','50%').css('margin-top',-picHeightScale/2);
        }
    };
    $.fn.picLazyLoad = function (settings) {
        var $this = $(this), _winScrollTop = 0, _winHeight = $(window).height();
        settings = $.extend({
            threshold: 0,
            placeholder: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC'
        }, settings || {});
        lazyLoadPic();
        $(window).on('scroll', function () {
            _winScrollTop = $(window).scrollTop();
            lazyLoadPic();
        });
        function lazyLoadPic() {
            $this.each(function () {
                var $self = $(this);
                if ($self.is('img')) {
                    if ($self.attr('data-original')) {
                        var _offsetTop = $self.offset().top;
                        if ((_offsetTop - settings.threshold) <= (_winHeight + _winScrollTop)) {
                            $self.attr('src', $self.attr('data-original'));
                            $self.removeAttr('data-original');
                            var picBoxItem = $self.parent();
                            _picCenter(picBoxItem);
                        }
                    }
                } else {
                    if ($self.attr('data-original')) {
                        if ($self.css('background-image') == 'none') {
                            $self.css('background-image', 'url(' + settings.placeholder + ')');
                        }
                        var _offsetTop = $self.offset().top;
                        if ((_offsetTop - settings.threshold) <= (_winHeight + _winScrollTop)) {
                            $self.css('background-image', 'url(' + $self.attr('data-original') + ')');
                            $self.removeAttr('data-original');
                        }
                    }
                }
            });
        }
    }
})(Zepto);
